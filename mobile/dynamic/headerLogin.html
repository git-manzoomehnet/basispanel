<basis core="api" url="https://api.trust-login.com/schema/[##cms.cookie.rkey##]/fa" method="get" name="db.userinfo"
    run="AtClient" OnProcessed="onProcessedInfoFn">
</basis>
<basis core="dbsource" source="trustloginapi" name="db" useragent="[##cms.request.user-agent##]"
    ip="[##cms.request.clientip##]">
    <member name="dmntoken" type="scalar" request="dmntoken" />
</basis>
<basis core="api" url="https://api.trust-login.com/logout/[##cms.cookie.rKey##]" method="post" run="atclient"
    name="api.logout" onprocessed="onprocessedlogoutfn" if="{##query.flag.value|(false)##}"
    body='{"dmntoken":"[##db.dmntoken.dmntoken##]"}' triggers="db.logout query.flag">
</basis>
<header class="MobileHeader [&.bgWhite]:bg-White duration-500 flex-col fixed top-0 left-0 z-50 w-full py-[1em] flex justify-center items-center">
    <div class="InnerHeader w-90p grid grid-cols-2">
        <div class="RightSec w-full flex justify-start gap-2 items-center">
            <div class="Logo w-auto flex justify-center items-center">
                <a href="/" alt="basis" title="basis">
                    <img src="[##cms.cms.cdn##]/images/logo-mobile-v3.png" alt="basis" title="basis">
                </a>
            </div>
            <div
                class="burger-container group/burger relative flex w-[50px] cursor-pointer rotate-0 duration-[.3s]">
                <div id="burger" class="w-[18px] gap-1 relative flex flex-col top-[50%] mx-[4px]">
                    <div class="bar topBar group-[&.menu-opened]/burger:translate-y-[5px] group-[&.menu-opened]/burger:rotate-[-45deg]
                   w-full h-[2px] rounded-5 bg-textGray block  duration-[.3s] delay-0"></div>
                    <div
                        class="bar mdlBar w-full h-[2px] rounded-5 group-[&.menu-opened]/burger:translate-x-[-100px] group-[&.menu-opened]/burger:opacity-0 bg-textGray block  duration-[.3s] delay-0">
                    </div>
                    <div class="bar btmBar group-[&.menu-opened]/burger:translate-y-[-7px] group-[&.menu-opened]/burger:rotate-45
                   w-full h-[2px] rounded-5 bg-textGray block  duration-[.3s] delay-0"></div>
                </div>
            </div>
        </div>
        <div class="LeftSec w-full flex justify-end">
            <div class="Btns w-auto flex gap-5">
                <div class="UserProfile-box relative w-auto flex gap-4 flex-col">
                    <div class="User w-auto flex gap-4 hover:cursor-pointer">
                      <span class="Icon [&.openProf]:rotate-180 duration-150 w-auto flex justify-center items-center my-auto">
                          <svg width="12" height="8" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path d="M6 7.4L0 1.4L1.4 0L6 4.6L10.6 0L12 1.4L6 7.4Z" fill="#5F6368"/>
                              </svg>
                              
                      </span>
                      <span class="User-Image w-[32px] h-[32px] rounded-full flex justify-center items-center">
                          <img src="/images/m-avatar.png" alt="" class="rounded-full w-full h-full object-cover">
                      </span>
              
                    </div>
                    <div class="UserDropdown bg-White absolute top-[4em] opacity-0 translate-y-[-2em] duration-500 [&.openProf]:opacity-[1]
                    [&.openProf]:translate-y-[0]   min-w-[140px] left-[-6px] right-[inherit] mx-auto w-auto  py-[.5em] flex">
                      <div class="Box w-auto px-[.7em] py-[.7em] flex flex-col gap-2 min-w-[140px]">
                          <div class="title w-full flex justify-start items-start leading-[15.65px]
                           text-dark3 font-IRANSansWeb400 font-normal text-[10px]">
                              نام کاربری
                          </div>
                          <span class="Username pb-[.5em] leading-[20.35px] border-b-[1px] border-mainGray
                          text-black font-IRANSansWeb400 font-normal text-[13px]">

                          </span>
  <a href="/panel" class=" hover:cursor-pointer w-full flex justify-between items-center">
                        <div class="text leading-[21.91px]
                        text-black font-IRANSansWeb400 font-normal text-xs">
                            پنل کاربری
                        </div>
                        <div class=" w-auto my-auto">
                            <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="#5F6368"><path d="M520-600v-240h320v240H520ZM120-440v-400h320v400H120Zm400 320v-400h320v400H520Zm-400 0v-240h320v240H120Zm80-400h160v-240H200v240Zm400 320h160v-240H600v240Zm0-480h160v-80H600v80ZM200-200h160v-80H200v80Zm160-320Zm240-160Zm0 240ZM360-280Z"/></svg>                       
                        </div>
                    </a>
                          <span class="logoOut w-full flex justify-between items-center">
                              <div class="text leading-[21.91px]
                              text-black font-IRANSansWeb400 font-normal text-sm">
                                  خارج شدن
                              </div>
                              <div class=" w-auto my-auto">
                                  <svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                                      <path d="M1.54167 12.875C1.15208 12.875 0.818576 12.7363 0.541146 12.4589C0.263715 12.1814 0.125 11.8479 0.125 11.4583V1.54167C0.125 1.15208 0.263715 0.818576 0.541146 0.541146C0.818576 0.263715 1.15208 0.125 1.54167 0.125H6.5V1.54167H1.54167V11.4583H6.5V12.875H1.54167ZM9.33333 10.0417L8.35938 9.01458L10.1656 7.20833H4.375V5.79167H10.1656L8.35938 3.98542L9.33333 2.95833L12.875 6.5L9.33333 10.0417Z" fill="#5F6368"/>
                                      </svg>                                    
                              </div>
                          </span>
                      </div>
                    </div>
                     </div>
            </div>
        </div>

    </div>
    <div class="Menu-container absolute left-0 top-0 flex h-[50px] bg-[transparent] w-full
    overflow-hidden delay-[.2s] z-1 group/menu pointer-events-none [&.menu-opened]:pointer-events-[all] [&.menu-opened]:h-svh
     [&.menu-opened]:bg-White">
        <ul class="menu w-90p mx-auto flex flex-col mb-auto mt-[8svh]">
            <li class="menu-item py-[.8em] border-b-[1px] border-primary group-[&.menu-opened]/menu:scale-[1]
             scale-[1.15] translate-y-[-30px]  opacity-0 group-[&.menu-opened]/menu:opacity-[1] group-[&.menu-opened]/menu:translate-y-[0]
            w-full flex justify-start items-center group/itemMenu">
                <a href="/" alt="خانه" title="خانه"  class="menu-link font-IRANSansWeb400 group-hover/itemMenu:text-primary duration-200
                 font-normal text-sm text-textGray">
                    خانه
                </a>
            </li>
            <li class="menu-item py-[.8em] border-b-[1px] border-primary group-[&.menu-opened]/menu:scale-[1]
            scale-[1.15] translate-y-[-30px]  opacity-0 group-[&.menu-opened]/menu:opacity-[1] group-[&.menu-opened]/menu:translate-y-[0]
           w-full flex justify-start items-center group/itemMenu">
                <a href="/solutions" alt="راهکارها" title="راهکارها" class="menu-link font-IRANSansWeb400 group-hover/itemMenu:text-primary duration-200
           font-normal text-sm text-textGray">
           راهکارها
                </a>
            </li>
            <li class="menu-item py-[.8em] border-b-[1px] border-primary group-[&.menu-opened]/menu:scale-[1]
            scale-[1.15] translate-y-[-30px]  opacity-0 group-[&.menu-opened]/menu:opacity-[1] group-[&.menu-opened]/menu:translate-y-[0]
           w-full flex justify-start items-center group/itemMenu">
                <a href="/pricelist" alt="تعرفه" title="تعرفه" class="menu-link font-IRANSansWeb400 group-hover/itemMenu:text-primary duration-200
           font-normal text-sm text-textGray">
          تعرفه ها
                </a>
            </li>
            <li class="menu-item py-[.8em] border-b-[1px] border-primary group-[&.menu-opened]/menu:scale-[1]
            scale-[1.15] translate-y-[-30px]  opacity-0 group-[&.menu-opened]/menu:opacity-[1] group-[&.menu-opened]/menu:translate-y-[0]
           w-full flex justify-start items-center group/itemMenu">
                <a href="/about" alt=" درباره ما" title=" درباره ما" class="menu-link font-IRANSansWeb400 group-hover/itemMenu:text-primary duration-200
           font-normal text-sm text-textGray">
           درباره ما
                </a>
            </li>
            <li class="menu-item py-[.8em] border-b-[1px] border-primary group-[&.menu-opened]/menu:scale-[1]
            scale-[1.15] translate-y-[-30px]  opacity-0 group-[&.menu-opened]/menu:opacity-[1] group-[&.menu-opened]/menu:translate-y-[0]
           w-full flex justify-start items-center group/itemMenu">
                <a href="/contact" alt="تماس با ما" title="تماس با ما" class="menu-link font-IRANSansWeb400 group-hover/itemMenu:text-primary duration-200
           font-normal text-sm text-textGray">
           تماس با ما
                </a>
            </li>
            <li class="menu-item py-[.8em] border-b-[1px] border-primary group-[&.menu-opened]/menu:scale-[1]
            scale-[1.15] translate-y-[-30px]  opacity-0 group-[&.menu-opened]/menu:opacity-[1] group-[&.menu-opened]/menu:translate-y-[0]
           w-full flex justify-start items-center group/itemMenu">
                <a href="/versions" alt="تغییرات" title="تغییرات" class="menu-link font-IRANSansWeb400 group-hover/itemMenu:text-primary duration-200
           font-normal text-sm text-textGray">
           آخرین تغییرات
                </a>
            </li>
        </ul>
    </div>

</header>
<div class="Alert-container pointer-events-none [&.Show]:pointer-events-auto group/Alert fixed top-[3em] left-0 opacity-0 translate-y-[-100%] 
[&.Show]:opacity-[1] [&.Show]:translate-y-[0]
right-0 mx-auto z-[999] flex justify-center items-center">
    <div class="Message relative w-max px-[2em] py-[1.6em]
   rounded-5 flex gap-3 group-[&.Error]/Alert:bg-redBG group-[&.Success]/Alert:bg-secondaryBG">
       
        <span class="icon ml-3 relative w-auto flex justify-center items-center">
            <svg class="suc absolute opacity-0 duration-150 group-[&.Error]/Alert:opacity-0
           group-[&.Success]/Alert:opacity-[1]" width="18" height="13" viewBox="0 0 18 13" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <path class="group-[&.Error]/Alert:fill-red"
                    d="M6.55 13L0.85 7.3L2.275 5.875L6.55 10.15L15.725 0.974999L17.15 2.4L6.55 13Z" fill="#00A693" />
            </svg>
            <svg class="er absolute opacity-0 duration-150 
          group-[&.Error]/Alert:opacity-[1] 
          group-[&.Success]/Alert:opacity-0" width="25" height="25" viewBox="0 0 25 25" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M12.5 17.5C12.7833 17.5 13.0167 17.4083 13.2 17.225C13.4 17.025 13.5 16.7833 13.5 16.5C13.5 16.2167 13.4 15.9833 13.2 15.8C13.0167 15.6 12.7833 15.5 12.5 15.5C12.2167 15.5 11.975 15.6 11.775 15.8C11.5917 15.9833 11.5 16.2167 11.5 16.5C11.5 16.7833 11.5917 17.025 11.775 17.225C11.975 17.4083 12.2167 17.5 12.5 17.5ZM11.5 13.5H13.5V7.5H11.5V13.5ZM12.5 22.5C11.1167 22.5 9.81667 22.2417 8.6 21.725C7.38333 21.1917 6.325 20.475 5.425 19.575C4.525 18.675 3.80833 17.6167 3.275 16.4C2.75833 15.1833 2.5 13.8833 2.5 12.5C2.5 11.1167 2.75833 9.81667 3.275 8.6C3.80833 7.38333 4.525 6.325 5.425 5.425C6.325 4.525 7.38333 3.81667 8.6 3.3C9.81667 2.76667 11.1167 2.5 12.5 2.5C13.8833 2.5 15.1833 2.76667 16.4 3.3C17.6167 3.81667 18.675 4.525 19.575 5.425C20.475 6.325 21.1833 7.38333 21.7 8.6C22.2333 9.81667 22.5 11.1167 22.5 12.5C22.5 13.8833 22.2333 15.1833 21.7 16.4C21.1833 17.6167 20.475 18.675 19.575 19.575C18.675 20.475 17.6167 21.1917 16.4 21.725C15.1833 22.2417 13.8833 22.5 12.5 22.5ZM12.5 20.5C14.7333 20.5 16.625 19.725 18.175 18.175C19.725 16.625 20.5 14.7333 20.5 12.5C20.5 10.2667 19.725 8.375 18.175 6.825C16.625 5.275 14.7333 4.5 12.5 4.5C10.2667 4.5 8.375 5.275 6.825 6.825C5.275 8.375 4.5 10.2667 4.5 12.5C4.5 14.7333 5.275 16.625 6.825 18.175C8.375 19.725 10.2667 20.5 12.5 20.5Z"
                    fill="#F9461C" />
            </svg>

        </span>
        <p class="error font-IRANSansWeb700 font-bold
        leading-25.04 group-[&.Success]/Alert:text-secondary group-[&.Error]/Alert:text-red
         text-center">شما با موفقیت وارد شدید، بعد از گذشت چند ثانیه به پنل کاربری هدایت می‌شوید </p>
        <span class="Line absolute bottom-0 right-0 h-[4px] w-0 group-[&.Success]/Alert:bg-secondary
       group-[&.Error]/Alert:bg-red rounded-5"></span>
    </div>
</div>
<script>
    const host = {
    settings: {
        'connection.web.callcommand': '/',
        'connection.web.basiscore': 'https://basispanel.ir/apicms',
        'connection.web.accounting': 'https://basispanel.ir/apicms',
        'connection.web.trust_login': 'https://basispanel.ir/apicms',
        'connection.web.media': 'https://basispanel.ir/apicms',
        'default.dbsource.verb': 'post',
        'default.call.verb': 'get',
        "connection.web.callcommand": "/",
        'default.viewCommand.groupColumn': 'prpid',
        'default.dmnid': '35',
        'default.binding.regex': '\\{##([^#]*)##\\}'
    }
}
let Errorcontainer = document.querySelector('.Alert-container')
let ErrorText = Errorcontainer.querySelector('p.error')
const AlertMessage = (className, errorText) => {
    Errorcontainer.classList.add(className)
    Errorcontainer.classList.add('Show')
    ErrorText.innerHTML = errorText
    setTimeout(() => {
        Errorcontainer.classList.remove('Show')
        setTimeout(() => {
            Errorcontainer.classList.remove(className)
        }, 2200);
    }, 2000);

}
     const logoutBtnn = document.querySelector(".logoOut ")
     async function onProcessedInfoFn(args) {
        const response = args.response;

        if (response.status == 200) {
            const responseJson = await response.json();
            if (responseJson.sources) {
                console.log(responseJson.sources[0].data[0].properties);
                responseJson.sources[0].data[0].properties.forEach((e) => { console.log(e) })
                //  get name
                const findName = responseJson.sources[0].data[0].properties.find((e) => {
                    return e.prpId == 1;
                });
                const nameusr = findName ? findName.answers[0].parts[0].values[0].value : null;
                // get lastname
                const findLastname = responseJson.sources[0].data[0].properties.find((e) => {
                    return e.prpId == 2;
                });
                const lastname = findLastname ? findLastname.answers[0].parts[0].values[0].value : null;

                // get avatar
                const findAvatar = responseJson.sources[0].data[0].properties.find((e) => {
                    return e.prpId == 94;
                });
                const avatar = findAvatar ? findAvatar.answers[0].parts[2].values[0].value : null;
                console.log(findAvatar);

                document.querySelector(".UserDropdown .Username").innerText = `${nameusr} ${lastname}`
                // document.querySelector(".phoneuser").innerHTML = phonenumber[0].answer
                if (avatar == undefined || avatar == null || avatar.length == 0) {
                    document.querySelector(".UserProfile-box .User-Image img").src = "/images/m-avatar.png"
                } else {
                    console.log("sss" , avatar)
                    console.log("sss" , avatar[1].answer)
                    document.querySelector(".UserProfile-box .User-Image img").src = `https://basiserp.ir/panel/[##cms.cookie.rkey##]/users/${avatar}`
                }

            }

        }
    }
    async function onprocessedlogoutfn(args) {
        const response = args.response;
        const json = await response.json();
        if (json.errorid == 20) {
            // incorrect inputs
            console.log("err not login");
        }
        else if (json.errorid == 30 || json.errorid == 20) {
            // successful
            window.location.href = window.location.href;
            function getAndDeleteCookie(name) {
                let cookieArr = document.cookie.split(";");
                for (let i = 0; i < cookieArr.length; i++) {
                    let cookiePair = cookieArr[i].split("=");
                    if (name === cookiePair[0].trim()) {
                        let cookieValue = decodeURIComponent(cookiePair[1]);
                        document.cookie = name + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                        return cookieValue;
                    }
                }
                return null;
            }
            let myCookie = getAndDeleteCookie("rkey");



        }
        else {
            console.log("So :|")

        }

    }
</script>