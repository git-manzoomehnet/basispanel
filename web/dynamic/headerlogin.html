<basis core="api" url="https://api.trust-login.com/schema/[##cms.cookie.rkey##]/fa" method="get" name="db.userinfo"
    run="AtClient" OnProcessed="onProcessedInfoFn">
</basis>
<basis core="dbsource" source="trustloginapi" name="db" useragent="[##cms.request.user-agent##]"
    ip="[##cms.request.clientip##]">
    <member name="dmntoken" type="scalar" request="dmntoken" />
</basis>
<basis core="api" url="https://api.trust-login.com/logout/[##cms.cookie.rKey##]" method="post" run="atclient"
    name="api.logout" onprocessed="onprocessedlogoutfn" if="{##query.flag.value|(false)##}"
    body='{"dmntoken":"[##db.dmntoken.dmntoken##]"}' triggers="db.logout query.flag">
</basis>
<header class="DesktopHeader inLogin fixed top-0 left-0 z-50 w-full py-[2em] flex justify-center items-center">
    <div class="InnerHeader w-80p grid grid-cols-[2fr,1fr]">
        <div class="RightSec w-full flex justify-start gap-9">
            <div class="Logo w-auto flex justify-center items-center">
                <a href="/" alt="basis" title="basis">
                    <img src="[##cms.cms.cdn##]/images/logo-v3.png" alt="basis" title="basis">
                </a>
            </div>
            <nav class="Menu-header w-auto flex justify-start items-center gap-6">
                <ul class="w-auto flex gap-6 justify-start items-center">
                    <li class="menu-item w-auto flex justify-center items-center group/itemMenu">
                        <a href="/" alt="خانه" title="خانه" class="menu-link font-IRANSansWeb400 group-hover/itemMenu:text-primary duration-200
                       font-normal text-sm text-textGray">
                            خانه
                        </a>
                    </li>
                    <li class="menu-item w-auto flex justify-center items-center group/itemMenu">
                        <a href="#" alt="راهکارها" title="راهکارها" class="menu-link font-IRANSansWeb400 group-hover/itemMenu:text-primary duration-200
                       font-normal text-sm text-textGray">
                       راهکارها
                        </a>
                    </li>
                    <li class="menu-item w-auto flex justify-center items-center group/itemMenu">
                        <a href="#" alt="بلاگ" title="بلاگ" class="menu-link font-IRANSansWeb400 group-hover/itemMenu:text-primary duration-200
                       font-normal text-sm text-textGray">
                       بلاگ
                        </a>
                    </li>
                    <li class="menu-item w-auto flex justify-center items-center group/itemMenu">
                        <a href="#" alt="  درباره ما" title="  درباره ما" class="menu-link font-IRANSansWeb400 group-hover/itemMenu:text-primary duration-200
                     font-normal text-sm text-textGray">
                            درباره ما
                        </a>
                    </li>
                    <li class="menu-item w-auto flex justify-center items-center group/itemMenu">
                        <a href="#" alt="  تماس با ما" title="  تماس با ما" class="menu-link font-IRANSansWeb400 group-hover/itemMenu:text-primary duration-200
                     font-normal text-sm text-textGray">
                            تماس با ما
                        </a>
                    </li>
                    <li class="menu-item w-auto flex justify-center items-center group/itemMenu">
                        <a href="/versions" alt="تغییرات" title="تغییرات" class="menu-link font-IRANSansWeb400 group-hover/itemMenu:text-primary duration-200
                     font-normal text-sm text-textGray">
                            آخرین تغییرات
                        </a>
                    </li>
                 
                </ul>
                <div class="lang w-auto flex justify-start items-center relative z-2">
                    <div class="langC w-auto flex justify-center items-center">
                        <span class="langs hover:cursor-pointer w-auto flex gap-1 justify-center items-center">
                            <span class="langIcon">
                                <img src="[##cms.cms.cdn##]/images/Group 35649.png" alt="basis" title="basis">
                            </span>

                            <span class="langText font-IRANSansWeb400 font-normal text-[13px] text-textGray">
                                انگلیسی
                            </span>

                        </span>
                        <span class="icon w-auto flex justify-center items-center mr-2 translate-y-[3px]">
                            <svg class="[&.rotate]:rotate-[180deg] duration-200" width="9" height="5" viewBox="0 0 9 5"
                                fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M7 1H3H2L4.5 4L7 1Z" fill="#494949" stroke="#494949" />
                            </svg>
                        </span>
                    </div>


                    <div class="langs-content absolute top-[2em] bg-primary left-[10%] flex flex-col  w-[70px] bg-white opacity-0
             duration-[.3s] [&.openLang]:opacity-[1]   [&.openLang]:pointer-events-auto pointer-events-none">
                        <ul class="w-full flex flex-col">
                            <li class="w-auto flex justify-center group/langs duration-100 py-[.5em] hover:text-textGray
                          hover:bg-White ">
                                <a href="/en" alt="basis" title="basis class=" w-auto flex">
                                    <span class="langText font-IRANSansWeb400 font-normal duration-100 text-[13px] group-hover/langs:text-textGray
                                 text-White">
                                        انگلیسی
                                    </span>
                                </a>


                            </li>
                            <li class="w-auto flex justify-center group/langs  duration-100 py-[.5em] hover:text-textGray
                          hover:bg-White ">
                                <a href="/" alt="بیسیس پنل" title="بیسیس پنل" class="w-auto flex">
                                    <span
                                        class="langText font-IRANSansWeb400 font-normal duration-100 group-hover/langs:text-textGray text-[13px] text-White">
                                        فارسی
                                    </span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
        <div class="LeftSec w-full flex justify-end">
            <div class="Btns w-auto flex gap-5">
                <a href="/demo" alt="basis" title="basis" class="button w-max px-[1.7em] hover:bg-hoverBtnDprimary duration-200
                 py-[.8em] bg-primary flex justify-center items-center rounded-5">
                    <button type="button " class="w-auto flex justify-center
                     text-White items-center font-IRANSansWeb400 font-normal text-sm rounded-5">
                        درخواست دمو
                    </button>
                </a>
               <div class="UserProfile-box relative w-auto flex gap-4 flex-col">
              <div class="User w-auto flex gap-4 hover:cursor-pointer">
                <span class="Icon [&.openProf]:rotate-180 duration-150 w-auto flex justify-center items-center my-auto">
                    <svg width="12" height="8" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 7.4L0 1.4L1.4 0L6 4.6L10.6 0L12 1.4L6 7.4Z" fill="#5F6368"/>
                        </svg>
                        
                </span>
                <span class="User-Image w-[47px] h-[47px] rounded-full flex justify-center items-center">
                    <img src="http://a4tech.webisaz.ir/images/m-avatar.png" alt="" class="rounded-full w-full h-full object-cover">
                </span>
        
              </div>
              <div class="UserDropdown border-[1px] rounded-5 border-lightBlue bg-White absolute top-[4em] opacity-0 translate-y-[-2em] duration-500 [&.openProf]:opacity-[1]
              [&.openProf]:translate-y-[0]   min-w-[140px] left-0 right-0 mx-auto w-auto  py-[.5em] flex">
                <div class="Box w-auto px-[.7em] py-[.7em] flex flex-col gap-2 min-w-[140px]">
                    <div class="title w-full flex justify-start items-start leading-[15.65px]
                     text-dark3 font-IRANSansWeb400 font-normal text-[10px]">
                        نام کاربری
                    </div>
                    <span class="Username pb-[.5em] leading-[20.35px] border-b-[1px] border-mainGray
                    text-black font-IRANSansWeb400 font-normal text-[13px]">
                        غدیره مرادی
                    </span>
                    <span class="logoOut hover:cursor-pointer w-full flex justify-between items-center">
                        <div class="text leading-[21.91px]
                        text-black font-IRANSansWeb400 font-normal text-sm">
                            خارج شدن
                        </div>
                        <div class=" w-auto my-auto">
                            <svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M1.54167 12.875C1.15208 12.875 0.818576 12.7363 0.541146 12.4589C0.263715 12.1814 0.125 11.8479 0.125 11.4583V1.54167C0.125 1.15208 0.263715 0.818576 0.541146 0.541146C0.818576 0.263715 1.15208 0.125 1.54167 0.125H6.5V1.54167H1.54167V11.4583H6.5V12.875H1.54167ZM9.33333 10.0417L8.35938 9.01458L10.1656 7.20833H4.375V5.79167H10.1656L8.35938 3.98542L9.33333 2.95833L12.875 6.5L9.33333 10.0417Z" fill="#5F6368"/>
                                </svg>                                    
                        </div>
                    </span>
                </div>
              </div>
               </div>
            </div>
        </div>
 
    </div>
</header>

<script>
    const host = {
    settings: {
        'connection.web.callcommand': '/',
        'connection.web.basiscore': 'https://basispanel.ir/apicms',
        'connection.web.accounting': 'https://basispanel.ir/apicms',
        'connection.web.trust_login': 'https://basispanel.ir/apicms',
        'connection.web.media': 'https://basispanel.ir/apicms',
        'default.dbsource.verb': 'post',
        'default.call.verb': 'get',
        "connection.web.callcommand": "/",
        'default.viewCommand.groupColumn': 'prpid',
        'default.dmnid': '35',
        'default.binding.regex': '\\{##([^#]*)##\\}'
    }
}
     const logoutBtnn = document.querySelector(".logoOut ")
    // logoutBtnn.addEventListener("click", () => {
    //     $bc.setSource("query.flag", true)

    // })
     async function onProcessedInfoFn(args) {
        const response = args.response;

        if (response.status == 200) {
            const responseJson = await response.json();
            if (responseJson.sources) {
                console.log(responseJson.sources[0].data[0].properties);
                responseJson.sources[0].data[0].properties.forEach((e) => { console.log(e) })
                //  get name
                const findName = responseJson.sources[0].data[0].properties.find((e) => {
                    return e.prpId == 1;
                });
                const nameusr = findName ? findName.answers[0].parts[0].values[0].value : null;
                // get lastname
                const findLastname = responseJson.sources[0].data[0].properties.find((e) => {
                    return e.prpId == 2;
                });
                const lastname = findLastname ? findLastname.answers[0].parts[0].values[0].value : null;

                // get avatar
                const findAvatar = responseJson.sources[0].data[0].properties.find((e) => {
                    return e.prpId == 94;
                });
                const avatar = findAvatar ? findAvatar.answers[0].parts[2].values[0].value : null;
                console.log(findAvatar);

                document.querySelector(".UserDropdown .Username").innerText = `${nameusr} ${lastname}`
                // document.querySelector(".phoneuser").innerHTML = phonenumber[0].answer
                if (avatar == undefined || avatar == null || avatar.length == 0) {
                    document.querySelector(".UserProfile-box .User-Image img").src = "http://a4tech.webisaz.ir/images/m-avatar.png"
                } else {
                    console.log("sss" , avatar)
                    console.log("sss" , avatar[1].answer)
                    document.querySelector(".UserProfile-box .User-Image img").src = `https://basiserp.ir/panel/[##cms.cookie.rkey##]/users/${avatar}`
                }

            }

        }
    }
    async function onprocessedlogoutfn(args) {
        const response = args.response;
        const json = await response.json();
        if (json.errorid == 20) {
            // incorrect inputs
            console.log("err not login");
        }
        else if (json.errorid == 30 || json.errorid == 20) {
            // successful
            window.location.href = window.location.href;
            function getAndDeleteCookie(name) {
                let cookieArr = document.cookie.split(";");
                for (let i = 0; i < cookieArr.length; i++) {
                    let cookiePair = cookieArr[i].split("=");
                    if (name === cookiePair[0].trim()) {
                        let cookieValue = decodeURIComponent(cookiePair[1]);
                        document.cookie = name + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                        return cookieValue;
                    }
                }
                return null;
            }
            let myCookie = getAndDeleteCookie("rkey");



        }
        else {
            console.log("So :|")

        }

    }
</script>